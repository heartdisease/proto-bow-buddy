<!--
This file is part of BowBuddy.

BowBuddy is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

BowBuddy is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with BowBuddy.  If not, see <http://www.gnu.org/licenses/>.


Copyright 2017 Christoph Matscheko
-->
<!DOCTYPE html>
<html class="no-js" lang="en">
	<head>
		<meta charset="utf-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
		<title>BowBuddy {$version} (Prototype)</title>
		<meta name="author" content="Christoph Matscheko" />
		<meta name="description" content="An app for keeping track of your score in archery" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link rel="stylesheet" href="css/materialize.min.css" />
		<link rel="stylesheet" href="css/main.css" />
		<style>
			body {
				padding-top: 10px;
				padding-bottom: 20px;
				font-family: "Roboto", sans-serif;
			}
			
			#main {
				text-align: center;
			}
			
			.app-logo {
				margin-bottom: 45px;
			}
		
			
			.main-menu > a {
				display: block;
				clear: both;
				width: 250px;
				margin-bottom: 15px;
				margin-left: auto;
				margin-right: auto;
			}
			
			.main-menu > a > span.glyphicon {
				top: 2px;
				left: -4px;
			}
			
			#db-dump-modal textarea {
				margin-top: 14px;
				width: 100%;
				height: auto;
				font-family: monospace;
			}
		</style>
		<script src="js/vendor/modernizr-2.8.3-respond-1.4.2.min.js"></script>
	</head>
	<body>
		<div class="container" id="main">
			<div class="app-logo">
				<h1>&nbsp;<!-- INSERT APP TITLE HERE --></h1>
			</div>

			<div class="container-fluid main-menu">
				<a class="waves-effect waves-light btn-large green" href="views/new-game.html" role="button"><span class="glyphicon glyphicon-screenshot" aria-hidden="true"></span> New Game</a>
				<a class="waves-effect waves-light btn-large disabled" href="#" role="button"><span class="glyphicon glyphicon-cog" aria-hidden="true"></span> Course Settings</a>
				<a class="waves-effect waves-light btn-large disabled" href="#" role="button"><span class="glyphicon glyphicon-cog" aria-hidden="true"></span> Player Settings</a>
				<a class="waves-effect waves-light btn-large disabled" href="#" role="button"><span class="glyphicon glyphicon-signal" aria-hidden="true"></span> Hall Of Fame</a>
				<a class="waves-effect waves-light btn-large red" href="#" role="button" id="quit-btn"><span class="glyphicon glyphicon-arrow-down" aria-hidden="true"></span> Quit</a>
			</div>
			
			<div class="modal" id="delete-db-modal">
				<div class="modal-content">
					<span class="modal-msg"></span>
				</div>
				<div class="modal-footer">
					<a type="button" class="modal-action modal-close waves-effect waves-red btn-flat" data-dismiss="modal">Close</a>
				</div>
			</div>
			
			<div class="modal modal-fixed-footer" id="db-dump-modal">
				<div class="modal-content">
					<textarea rows="16" cols="35"></textarea>
				</div>
				<div class="modal-footer">
					<div class="btn-group btn-group-justified">
						<a type="button" class="modal-action modal-close waves-effect waves-red btn-flat" data-dismiss="modal">Close</a>
						<a type="button" class="modal-action waves-effect waves-blue btn-flat" id="update-db-btn">Update Database</a>
					</div>
				</div>
			</div>
		</div>
		
		<script src="js/vendor/jquery-1.11.2.min.js"></script>
		<script src="js/vendor/materialize.min.js"></script>
		<script src="js/main.js"></script>
		<script>
			$(function(){
				"use strict";
				
				BowBuddy.updateWindowTitle(BowBuddy.getVersion());
				$(".app-logo > h1").text(document.title);
				
				// jQuery Plugin Initialization
				$(document).ready(() => $(".modal").modal());
				
				let logoCounter = 0;
				let quitCounter = 0;
			
				$(".app-logo")
					.on("click", BowBuddy.switchToFullscreenFunc())
					.on("click", (e) => {
						if (++logoCounter % 2 === 0) {
							BowBuddy.storage.dump()
								.then((dbObject) => {
									const dbDump = JSON.stringify(dbObject);
									const $textarea = $("#db-dump-modal textarea").val(dbDump);
									
									$("#update-db-btn")
										.on("click", (e) => {
											if (window.confirm("Do you want to rewrite the entire database with input JSON?")) {
												BowBuddy.storage.importDb(JSON.parse($textarea.val()))
													.then(() => window.alert("Database successfully imported!"))
													.catch((error) => console.error(error));
											}
										});
									
									console.log("BowBuddyDb dump:");
									console.log(dbObject); // show db object in console for close inspection
									
									$("#db-dump-modal").modal("open");
									window.setTimeout(() => $textarea.select(), 500);
								});
						}
					});
				$("#quit-btn").on("click", (e) => {
					if (++quitCounter % 4 === 0 && window.confirm("Are you sure you want to erase the entire database?")) {
						BowBuddy.storage.erase()
							.then((e) => {
								$("#delete-db-modal .modal-msg").text("Database was successfully deleted!");
							})
							.catch((e) => {
								$("#delete-db-modal .modal-msg").text("Failed to delete database!");
							})
							.then(() => {
								$("#delete-db-modal").modal("open");
							});
					}
				});
			});
		</script>
	</body>
</html>
